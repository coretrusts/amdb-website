<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AmDb性能优化指南 - 性能调优和最佳实践">
    <title>性能优化 - AmDb</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .doc-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 0;
        }
        .doc-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .doc-content h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        .doc-content h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .doc-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .performance-tip {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--success-color);
        }
        .performance-tip h3 {
            margin-top: 0;
            color: var(--success-color);
        }
        .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .benchmark-table th,
        .benchmark-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .benchmark-table th {
            background: var(--bg-light);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../index.html">
                    <span class="logo">AmDb</span>
                    <span class="tagline">高性能区块链数据库</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">首页</a></li>
                <li><a href="../index.html#features">特性</a></li>
                <li><a href="../index.html#docs" class="active">文档</a></li>
                <li><a href="../index.html#downloads">下载</a></li>
                <li><a href="../index.html#community">社区</a></li>
                <li><a href="https://github.com/coretrusts/amdb" target="_blank">GitHub</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <div class="container">
        <div class="doc-content">
            <h1>性能优化</h1>
            <p>AmDb性能优化指南和最佳实践。</p>

            <h2>性能基准</h2>
            <table class="benchmark-table">
                <thead>
                    <tr>
                        <th>操作类型</th>
                        <th>性能</th>
                        <th>目标</th>
                        <th>达成率</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>顺序写入</td>
                        <td>100,000+ ops/s</td>
                        <td>550,000 ops/s</td>
                        <td>18%</td>
                    </tr>
                    <tr>
                        <td>随机写入</td>
                        <td>8,000+ ops/s</td>
                        <td>52,000 ops/s</td>
                        <td>15%</td>
                    </tr>
                    <tr>
                        <td>随机读取</td>
                        <td>280,000+ ops/s</td>
                        <td>156,000 ops/s</td>
                        <td>180%</td>
                    </tr>
                </tbody>
            </table>

            <h2>优化建议</h2>

            <div class="performance-tip">
                <h3>1. 使用批量写入</h3>
                <p>批量写入比单个写入性能高数倍，建议使用batch_put()方法。</p>
                <div class="code-block">
                    <pre><code># 推荐：批量写入
items = [(b'key1', b'value1'), (b'key2', b'value2'), ...]
db.batch_put(items)

# 不推荐：单个写入
for key, value in items:
    db.put(key, value)</code></pre>
                </div>
            </div>

            <div class="performance-tip">
                <h3>2. 合理配置批量大小</h3>
                <p>在amdb.ini中配置batch_max_size，建议设置为1000-5000。</p>
                <div class="code-block">
                    <pre><code>[batch]
max_size = 5000  # 批量大小，影响写入性能</code></pre>
                </div>
            </div>

            <div class="performance-tip">
                <h3>3. 异步刷新策略</h3>
                <p>对于非关键数据，可以使用异步刷新，提升写入性能。</p>
                <div class="code-block">
                    <pre><code># 异步刷新（性能优先）
db.flush(async_mode=True)

# 同步刷新（数据安全优先）
db.flush(force_sync=True)</code></pre>
                </div>
            </div>

            <div class="performance-tip">
                <h3>4. 启用多线程</h3>
                <p>在配置文件中启用多线程支持，提升并发性能。</p>
                <div class="code-block">
                    <pre><code>[threading]
enable = true
max_workers = 4
enable_parallel_batch = true</code></pre>
                </div>
            </div>

            <div class="performance-tip">
                <h3>5. 优化版本管理</h3>
                <p>对于大批量写入，可以跳过prev_hash计算以提升性能。</p>
                <div class="code-block">
                    <pre><code>[version]
skip_prev_hash_threshold = 200  # 超过此阈值跳过prev_hash计算</code></pre>
                </div>
            </div>

            <h2>性能测试</h2>
            <div class="code-block">
                <pre><code># 运行性能测试
python tests/performance_benchmark.py

# 运行压力测试
python tests/stress_test.py</code></pre>
            </div>

            <h2>更多信息</h2>
            <ul>
                <li><a href="quickstart.html">快速开始</a></li>
                <li><a href="api.html">API文档</a></li>
                <li><a href="integration.html">集成指南</a></li>
            </ul>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>AmDb</h4>
                    <p>专为区块链设计的高性能数据库系统</p>
                </div>
                <div class="footer-section">
                    <h4>资源</h4>
                    <ul>
                        <li><a href="quickstart.html">快速开始</a></li>
                        <li><a href="api.html">API文档</a></li>
                        <li><a href="../index.html#downloads">下载</a></li>
                        <li><a href="https://github.com/coretrusts/amdb">GitHub</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>社区</h4>
                    <ul>
                        <li><a href="https://github.com/coretrusts/amdb/discussions">讨论区</a></li>
                        <li><a href="https://github.com/coretrusts/amdb/issues">问题反馈</a></li>
                        <li><a href="https://github.com/coretrusts/amdb/blob/main/CONTRIBUTING.md">贡献指南</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>关于</h4>
                    <ul>
                        <li><a href="https://github.com/coretrusts/amdb/blob/main/LICENSE">许可证</a></li>
                        <li><a href="https://github.com/coretrusts/amdb/releases">更新日志</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AmDb. All rights reserved. | Domain: getamdb.com</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>

